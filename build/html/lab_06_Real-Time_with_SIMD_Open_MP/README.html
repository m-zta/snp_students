
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta content="metadata description" lang="en" name="description" xml:lang="en" />
<meta content="description des métadonnées" lang="fr" name="description" xml:lang="fr" />
<meta content="Sphinx, MyST" name="keywords" />
<meta content="en_US" property="og:locale" />

    <title>06 - Real-Time with SIMD &#8212; MPC Labs  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="07a - Cluster Computing" href="../lab_07_cluster_computing/README.html" />
    <link rel="prev" title="05 - Incremental computation of moments" href="../lab_05_SIMD/README.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section class="tex2jax_ignore mathjax_ignore" id="real-time-with-simd">
<h1>06 - Real-Time with SIMD<a class="headerlink" href="#real-time-with-simd" title="Permalink to this headline">¶</a></h1>
<section id="introduction">
<h2>Introduction:<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>In this laboratory we wish to explore optimising designs using SMID instructions. We do this by getting you to implement a naïve implementation of a sound FIR-filter. As you should have completed the previous lab the task to master becomes one of streamlining data access.</p>
<p>This lab is marked and will score a maximum of 5 points. You have three lab sessions for this task (4.5 hours.)</p>
<section id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h3>
<p>This lab requires additional software on the Ultra96 plattform and so you must install dependencies:</p>
<section id="directly-install-the-dependencies-recommended">
<h4>Directly install the dependencies (recommended)<a class="headerlink" href="#directly-install-the-dependencies-recommended" title="Permalink to this headline">¶</a></h4>
<p>Using bash:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt install alsa-utils portaudio19-dev libsndfile1-dev linux-tools-common valgrind libne10-dev
</pre></div>
</div>
</section>
<section id="offline-installation">
<h4>Offline Installation<a class="headerlink" href="#offline-installation" title="Permalink to this headline">¶</a></h4>
<p>If you have not setup Internet access on the u96-ultra you can attempt an offline installation. For this a script is provided. Important, this method can not ensure a functioning installation as dependencies may not be installed. If this happens the method above must be used.</p>
<p>Using bash</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ./offline_install
chmod +x ./offline_install.sh
./offline_install.sh
</pre></div>
</div>
</section>
</section>
</section>
<hr class="docutils" />
<section id="learning-aims">
<h2>Learning aims<a class="headerlink" href="#learning-aims" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Practical design using SIMD instructions</p></li>
<li><p>Typical real-world, real-time signal processing problem</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="task">
<h2>Task<a class="headerlink" href="#task" title="Permalink to this headline">¶</a></h2>
<p>In the laboratory an audio file is read, filtered in the time domain to apply an echo effect, and stored in a new audio file. Students which have attended a digital signal processing class will know that there are better options to achieve this, but these methods are out of scope for this laboratory.</p>
<section id="id1">
<h3>Introduction<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>In this application a FIR filter is used to change the sound as if it were recorded in another room, to do this the impulse response of the room is convoluted with the input sound. By changing the impulse response, the audio effect can be modified. The block diagram below illustrates the computational process. The weights <strong>b</strong> are the samples of the impulse response used, while <strong>x[n]</strong> represents the input samples. The delay line (represented by the <strong>z<sup>-1</sup></strong> elements) is essentially a FIFO buffer, in which the newest sample is <strong>x[n]</strong> and the oldest sample is <strong>x[n-m]</strong>.</p>
<p><img alt="Bild1.png" src="../_images/Bild1.png" /></p>
<p>The process consists of multiplications and additions, and each output sample <strong>y[n]</strong> requires <strong>m+1</strong> multiplications between input samples <strong>x</strong> and weights <strong>b</strong>, as well as <strong>m+1</strong> additions.</p>
<p><img alt="Formula.png" src="../_images/Formula.png" /></p>
</section>
</section>
<hr class="docutils" />
<section id="fir-filter-implementation">
<h2>FIR Filter Implementation<a class="headerlink" href="#fir-filter-implementation" title="Permalink to this headline">¶</a></h2>
<section id="audio-file-processing">
<h3>Audio file processing<a class="headerlink" href="#audio-file-processing" title="Permalink to this headline">¶</a></h3>
<p>In order to access audio files, the sound file library is used (available in the libsndfile1-dev package). All interaction with this library are provided with the base code.</p>
<p>Depending on the implementation the runtime of the program can be relatively long. It is recommended to limit the number of input samples to 100’000 samples using the <code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">LENGTH_LIMIT</span></code>  and use the ‘test_input.wav’.</p>
<p>The correct working of the filter can easily be checked by ear as wrong implementations tend to sound wrong and/or noisy. For the same reason it is advised to reverse the filter coefficients, in this way the effects of the lower-order coefficients are better taken into account.</p>
</section>
<section id="task-1-data-preparation">
<h3>Task 1: Data Preparation<a class="headerlink" href="#task-1-data-preparation" title="Permalink to this headline">¶</a></h3>
<p>When working with an application like this efficient data transport is required. Digital signal processors have hardware architectural constructs to move data efficiently from memory to registers and back again, including acceleration of multiply and accumulate (MAC) operations. In our processors we do not have this luxury and so must ensure that the SIMD instructions are efficiently fed with data by carefully considering the code.</p>
<p>Ensuring that data transport is efficient in code bears similarity to efficient programming in assembler. One starts at an instruction, a SIMD one in this case, and work backwards to make sure the data has the least possible number of formatting and alignment steps before being put into the operand register. As we work in loops the loops have a minimum number of instructions which makes the loops efficient and hence, hopefully, accelerate the computation time.<br />
Further Hints:</p>
<ul class="simple">
<li><p>You can use <code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">FILTERSIZE_MOD</span></code> to ensure that the length of your filter is dividable by the chosen number.</p></li>
<li><p>You can use <code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">DELAYLINE_OVERSIZE</span></code> to extend the size of your delay line beyond the filter size.</p></li>
<li><p>During the data preparation phase, SIMD or OpenMP are not necessary as this phase only takes up a small fraction of the total runtime.</p></li>
<li></li>
</ul>
</section>
<section id="task-2-fir-filter">
<h3>Task 2: FIR Filter<a class="headerlink" href="#task-2-fir-filter" title="Permalink to this headline">¶</a></h3>
<p>Implement your FIR filter in the <code class="docutils literal notranslate"><span class="pre">filter_neon</span></code> function. The given code frame already includes a variable for the <code class="docutils literal notranslate"><span class="pre">delayline</span> <span class="pre">(float</span> <span class="pre">*reg)</span></code> and the current sample position <code class="docutils literal notranslate"><span class="pre">(uint32_t</span> <span class="pre">position)</span></code> which you can use in your filter function. Your filter implementation should use both SIMD and OpenMP.</p>
<p>Hints:</p>
<ul class="simple">
<li><p>To use SIMD and OpenMP in an efficient manner a nested loop can be advisable.</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="evaluation">
<h2>Evaluation<a class="headerlink" href="#evaluation" title="Permalink to this headline">¶</a></h2>
<p>This laboratory is evaluated on the basis of the discussions with you on your code/solution. You can receive a maximum of 5 marks for this laboratory.</p>
<p>A perfect solution is good. An imperfect solution is acceptable. If your solution doesn’t work or is not particularly performant, then it an identification of the problems and mistakes made will be accepted for grading.</p>
<p>I welcome in-depth discussions on the contents of the lab and your solutions during the implementation process.</p>
</section>
<hr class="docutils" />
<section id="appendix">
<h2>Appendix<a class="headerlink" href="#appendix" title="Permalink to this headline">¶</a></h2>
<section id="references">
<h3>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.portaudio.com/">http://www.portaudio.com/</a></p>
<p><a class="reference external" href="https://libsndfile.github.io/libsndfile/">https://libsndfile.github.io/libsndfile/</a></p>
<p><a class="reference external" href="https://developer.arm.com/architectures/instruction-sets/simd-isas/neon/intrinsics">https://developer.arm.com/architectures/instruction-sets/simd-isas/neon/intrinsics</a></p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo.png" alt="Logo"/>
    
    <h1 class="logo logo-name">MPC Labs</h1>
    
  </a>
</p>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../lab_01_Setup_Laboratory/README.html">01 - Setup Laboratory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab_02_Process_Threads_Task_Decomposition/README.html">02 - Process, Threads, Task Decomposition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab_03_Data_Decomposition/README.html">03 - Data Decomposition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab_04_OpenMP/README.html">04 - OpenMP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab_05_SIMD/README.html">05 - Incremental computation of moments</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">06 - Real-Time with SIMD</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction:</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#directly-install-the-dependencies-recommended">Directly install the dependencies (recommended)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#offline-installation">Offline Installation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#learning-aims">Learning aims</a></li>
<li class="toctree-l2"><a class="reference internal" href="#task">Task</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Introduction</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fir-filter-implementation">FIR Filter Implementation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#audio-file-processing">Audio file processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#task-1-data-preparation">Task 1: Data Preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#task-2-fir-filter">Task 2: FIR Filter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#evaluation">Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#appendix">Appendix</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../lab_07_cluster_computing/README.html">07a - Cluster Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix_u96.html">Ultra96-V2</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../lab_05_SIMD/README.html" title="previous chapter">05 - Incremental computation of moments</a></li>
      <li>Next: <a href="../lab_07_cluster_computing/README.html" title="next chapter">07a - Cluster Computing</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, stsh.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/lab_06_Real-Time_with_SIMD_Open_MP/README.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>